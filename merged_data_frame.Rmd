---
title: "creating data frame"
author: "Sophia"
date: "10/30/2023"
output: html_document
---

```{r}
geodf <- read.csv("geodata.csv")
colnames(geodf)[2] <- "TEAM"
write.csv(geodf, "geodata.csv", row.names=FALSE)

college_geo <- read.csv("geodata.csv")
bb_data <- read.csv("cbb.csv")

library(dplyr)
merged_data <- left_join(bb_data, college_geo, by = "TEAM")

library(leaflet)
leaflet(data = merged_data) %>% setView(lng = -95.71, lat = 37.09, zoom =3) %>% 
  addTiles() %>%
  addCircleMarkers(radius = 1, label = ~TEAM)
```

```{r}
merged_data %>%
  group_by(TEAM) %>%
  summarize(Count = sum(POSTSEASON == "Champions", na.rm = TRUE)) %>%
  filter(Count>0)

```


```{r}
merged_data %>%
  group_by(TEAM) %>%
  summarize(Count = sum(SEED <= 4, na.rm = FALSE))  %>%
  filter(Count>0)
```


```{r}
merged_data %>%
  group_by(TEAM) %>%
  summarize(Count = sum(POSTSEASON == "2ND", na.rm = TRUE)) %>%
  filter(Count>0)
```

```{r}
merged_data %>%
  group_by(TEAM) %>%
  summarize(Count = sum(POSTSEASON == "E8", na.rm = TRUE)) %>%
  filter(Count>0)
```

```{r}
merged_data %>%
  group_by(TEAM) %>%
  summarize(Count = sum(POSTSEASON == "F4", na.rm = TRUE)) %>%
  filter(Count>0)
```

```{r}
merged_data %>%
  group_by(TEAM) %>%
  summarize(Count = sum(POSTSEASON == "S16", na.rm = TRUE)) %>%
  filter(Count>0)
```


```{r}
merged_data %>%
  group_by(TEAM) %>%
  summarize(AvgValue = mean(FTR))
```

```{r}
library(ggplot2)
library(tidyverse)
ggplot(merged_data, aes(CONF, FTR)) + geom_bar(stat = 'identity') + theme(axis.text.x = element_text(angle = 60, hjust  = 1))
```

```{r}
library(ggplot2)

ggplot(data = merged_data, aes(x = factor(CONF), y = factor(YEAR), fill = FTR)) + 
  geom_tile() + 
  scale_fill_gradient(low = "white", high = "blue") +
  labs(title = "Heatmap of Conference Winner Free Throws", x = "CONF", y = "POSTSEAON") +
  theme_minimal()
```
```{r}
library(leaflet)
library(sf)
library(leaflet.extras)

us_map <- leaflet() %>%
  setView(lng = -96, lat = 37.8, zoom = 4) %>%
  addProviderTiles("CartoDB.Positron")

us_map <- us_map %>%
  addHeatmap( data = merged_data, radius = 2)

View(us_map)
```

```{r}
library(tidyverse)
ggplot(merged_data, aes(CONF, ADJOE)) + geom_bar(stat = 'identity') + theme(axis.text.x = element_text(angle = 60, hjust  = 1))
```

```{r}
library(ggplot2)
library(tidyverse)
ggplot(merged_data, aes(CONF, ADJDE)) + geom_bar(stat = 'identity') + theme(axis.text.x = element_text(angle = 60, hjust  = 1))
```

```{r}
ggplot(merged_data, aes(STATE, W)) + geom_bar(stat = 'identity') + theme(axis.text.x = element_text(angle = 60, hjust  = 1))
```

```{r}
library(dplyr)
state_avgPR <- merged_data %>%
  group_by(STATE) %>%
  summarize(avgPR = mean(BARTHAG, na.rm = TRUE))

library(sf)
library(ggplot2)
usStates <- st_read("cb_2018_us_state_500k.shp")
statePR <- left_join(state_avgPR, usStates, by = c("STATE" = "STUSPS"))

merged_data <- merged_data[complete.cases(merged_data$LAT, merged_data$LON),]
statePRsf <- st_as_sf(merged_data, coords = c("LON", "LAT"), crs = 4326)


ggplot(statePRsf) +
  geom_sf(aes(fill = statePRsf), color = "black", size = "0.5") +
  scale_fill_viridis_c(option = "magma", direction = -1) +
  labs(title = "Average Power Ratings of NCAA D1 Basketball Teams by State")  +
  theme_minimal() +
  theme(legend.position = "right")
```

